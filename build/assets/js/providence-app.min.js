class ProvidenceAnniversaryApp{constructor(){this.providenceCoords={lat:41.824,lng:-71.4128},this.map=null,this.isEditMode=!1,this.currentAudio=null,this.playlist=[],this.playlistIndex=0,this.isPlaying=!1,this.itineraryData=this.loadData("anniversary_itinerary",this.getDefaultItinerary()),this.notesData=this.loadData("anniversary_notes",{}),this.customMapPoints=this.loadData("anniversary_custom_points",[]),this.budgetData=this.loadData("anniversary_budget",{meals:200,drinks:100,extras:150}),this.userPlaylists=this.loadData("anniversary_playlists",[]),this.songMemories=this.loadData("anniversary_song_memories",[]),this.initializeApp()}async initializeApp(){this.setupEventListeners(),this.setupButtonFunctions(),this.setupPhotoGallery(),this.setupInteractiveMap(),this.setupOfflineMode(),this.setupPWAInstallPrompt(),this.restoreUserData(),this.initializeMusic(),console.log("üéâ Providence Anniversary App initialized!")}setupButtonFunctions(){window.scrollToSection=this.scrollToSection.bind(this),window.showLoveNote=this.showLoveNote.bind(this),window.generateBudgetPlan=this.generateBudgetPlan.bind(this),window.focusMapLocation=this.focusMapLocation.bind(this),window.startAddingCustomPoint=this.startAddingCustomPoint.bind(this),window.viewCustomPoints=this.viewCustomPoints.bind(this),window.clearCustomPoints=this.clearCustomPoints.bind(this),window.showMusicServicesModal=this.showMusicServicesModal.bind(this),window.toggleMusic=this.toggleMusic.bind(this),window.openModal=this.openModal.bind(this),window.closeModal=this.closeModal.bind(this),window.showLocationDetails=this.showLocationDetails.bind(this),window.hideLocationPanel=this.hideLocationPanel.bind(this),window.getDirections=this.getDirections.bind(this),window.requestUber=this.requestUber.bind(this),window.showMoreInfo=this.showMoreInfo.bind(this),window.playSoundCloudSong=this.playSoundCloudSong.bind(this),window.uploadAudioFile=this.uploadAudioFile.bind(this),window.shufflePlaylist=this.shufflePlaylist.bind(this),window.playAll=this.playAll.bind(this),window.stopAll=this.stopAll.bind(this),window.removeSong=this.removeSong.bind(this),window.createFromTemplate=this.createFromTemplate.bind(this),window.generateActivityPlaylist=this.generateActivityPlaylist.bind(this),window.generateMoodPlaylist=this.generateMoodPlaylist.bind(this),window.exploreLocalArtists=this.exploreLocalArtists.bind(this),window.generateVenuePlaylist=this.generateVenuePlaylist.bind(this),window.getLocalRadioHits=this.getLocalRadioHits.bind(this),window.shareToSocial=this.shareToSocial.bind(this),window.exportPlaylist=this.exportPlaylist.bind(this),window.simulateCollaboration=this.simulateCollaboration.bind(this),window.openCreatePlaylistModal=this.openCreatePlaylistModal.bind(this),window.sharePlaylist=this.sharePlaylist.bind(this),window.toggleEditMode=this.toggleEditMode.bind(this),window.addItineraryItem=this.addItineraryItem.bind(this),window.saveItinerary=this.saveItinerary.bind(this),window.resetItinerary=this.resetItinerary.bind(this),window.showPhotoUploadModal=this.showPhotoUploadModal.bind(this),window.syncWithPiServer=this.syncWithPiServer.bind(this)}loadData(e,i){try{var t=localStorage.getItem(e);return t?JSON.parse(t):i}catch(t){return console.error(`Error loading ${e}:`,t),i}}saveData(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){console.error(`Error saving ${e}:`,t)}}showNotification(t,e="success"){let i=document.createElement("div");i.className="fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 "+("success"===e?"bg-green-500 text-white":"error"===e?"bg-red-500 text-white":"bg-blue-500 text-white"),i.innerHTML=`
            <div class="flex items-center gap-2">
                <span>${"success"===e?"‚úÖ":"error"===e?"‚ùå":"‚ÑπÔ∏è"}</span>
                <span>${t}</span>
            </div>
        `,document.body.appendChild(i),setTimeout(()=>{i.style.opacity="0",setTimeout(()=>i.remove(),300)},3e3)}showLocationDetails(t){var e,i,o={gracies:{name:"Gracie's Restaurant",address:"194 Washington St, Providence, RI",phone:"(401) 272-7811",hours:"Tue-Sat 5:30-10:00 PM",description:"Upscale New American cuisine in an intimate setting",website:"https://www.graciesrestaurant.com"},"federal-hill":{name:"Federal Hill",address:"Atwells Ave, Providence, RI",description:"Little Italy of Providence with authentic Italian restaurants",highlights:["Authentic Italian cuisine","Historic neighborhood","Festival atmosphere"]},waterfront:{name:"Providence Waterfront",address:"India Point Park, Providence, RI",description:"Scenic waterfront with walking paths and harbor views",highlights:["Harbor views","Walking paths","Sunset photography"]},downtown:{name:"Downtown Providence",address:"Downtown Providence, RI",description:"Historic downtown with shopping, dining, and entertainment",highlights:["Historic architecture","Shopping","Nightlife"]}}[t];o?((e=document.getElementById("location-panel"))&&(e.classList.remove("hidden"),document.getElementById("location-name").textContent=o.name,document.getElementById("location-address").textContent=o.address,document.getElementById("location-description").textContent=o.description,e=document.getElementById("directions-btn"),i=document.getElementById("uber-btn"),e&&(e.dataset.location=t),i)&&(i.dataset.location=t),this.showNotification("Showing details for "+o.name,"info")):this.showNotification("Location not found","error")}hideLocationPanel(){var t=document.getElementById("location-panel");t&&t.classList.add("hidden")}getDirections(){var t=document.getElementById("directions-btn")?.dataset.location;t&&(t={gracies:"194 Washington St, Providence, RI","federal-hill":"Atwells Ave, Providence, RI",waterfront:"India Point Park, Providence, RI",downtown:"Downtown Providence, RI"}[t])&&(t="https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(t),window.open(t,"_blank"),this.showNotification("Opening directions in Google Maps","info"))}requestUber(){var t=document.getElementById("uber-btn")?.dataset.location;t&&(t={gracies:"194 Washington St, Providence, RI","federal-hill":"Atwells Ave, Providence, RI",waterfront:"India Point Park, Providence, RI",downtown:"Downtown Providence, RI"}[t])&&(t="https://m.uber.com/ul/?action=setPickup&dropoff[formatted_address]="+encodeURIComponent(t),window.open(t,"_blank"),this.showNotification("Opening Uber for ride request","info"))}showMoreInfo(){var t=document.getElementById("info-btn")?.dataset.location;t&&(t={gracies:"https://www.graciesrestaurant.com","federal-hill":"https://www.federalhillprov.com",waterfront:"https://www.providence.gov/parks",downtown:"https://www.goprovidence.com"}[t])&&(window.open(t,"_blank"),this.showNotification("Opening website for more information","info"))}initializeMusic(){this.playlist=[{id:"burning-blue",title:"Burning Blue",artist:"Mariah the Scientist",url:"https://soundcloud.com/mariahthescientist/burning-blue",type:"soundcloud"},{id:"little-things",title:"Little Things",artist:"Ella Mai",url:"https://soundcloud.com/ellamai/little-things",type:"soundcloud"}]}playSoundCloudSong(t,e,i){this.showNotification(`Playing: ${t} by `+e,"info"),this.currentAudio&&(this.currentAudio.pause(),this.currentAudio=null),document.getElementById("current-song-title").textContent=t,document.getElementById("current-song-artist").textContent=e;t=document.getElementById("music-player");t&&(t.innerHTML=`
                <iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" 
                        src="https://w.soundcloud.com/player/?url=${encodeURIComponent(i)}&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true">
                </iframe>
            `,t.classList.remove("hidden")),this.isPlaying=!0,this.updatePlayButtons()}uploadAudioFile(){var t=document.createElement("input");t.type="file",t.accept="audio/*",t.onchange=t=>{let e=t.target.files[0];e&&((t=new FileReader).onload=t=>{t=t.target.result,t={id:Date.now().toString(),title:e.name.replace(/\.[^/.]+$/,""),artist:"Your Upload",url:t,type:"upload"};this.playlist.push(t),this.saveData("anniversary_playlist",this.playlist),this.showNotification(`Added ${t.title} to your collection`,"success"),this.updateSongsList()},t.readAsDataURL(e))},t.click()}shufflePlaylist(){if(0===this.playlist.length)this.showNotification("No songs in playlist","error");else{for(let t=this.playlist.length-1;0<t;t--){var e=Math.floor(Math.random()*(t+1));[this.playlist[t],this.playlist[e]]=[this.playlist[e],this.playlist[t]]}this.showNotification("Playlist shuffled! üîÄ","success"),this.updateSongsList()}}playAll(){0===this.playlist.length?this.showNotification("No songs in playlist","error"):(this.playlistIndex=0,this.playCurrentSong(),this.showNotification("Playing all songs! üéµ","success"))}stopAll(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio=null),this.isPlaying=!1,this.updatePlayButtons();var t=document.getElementById("music-player");t&&t.classList.add("hidden"),this.showNotification("All music stopped","info")}removeSong(t){t=t.closest(".song-item");if(t){let e=t.querySelector(".text-white").textContent;this.playlist=this.playlist.filter(t=>t.title!==e),this.saveData("anniversary_playlist",this.playlist),t.remove(),this.showNotification(`Removed ${e} from playlist`,"success")}}playCurrentSong(){var t;this.playlistIndex>=this.playlist.length?this.showNotification("End of playlist reached","info"):(t=this.playlist[this.playlistIndex],this.playSoundCloudSong(t.title,t.artist,t.url))}updatePlayButtons(){document.querySelectorAll(".play-button").forEach(t=>{t.innerHTML=this.isPlaying?"‚è∏Ô∏è":"‚ñ∂Ô∏è"})}updateSongsList(){var t=document.getElementById("songs-list");t&&(t.innerHTML=this.playlist.map(t=>`
            <div class="song-item bg-white/10 rounded-lg p-4 flex items-center justify-between hover:bg-white/20 transition-colors">
                <div class="flex items-center space-x-4">
                    <div class="text-orange-400 text-2xl">üéµ</div>
                    <div>
                        <div class="text-white font-medium">${t.title}</div>
                        <div class="text-white/70 text-sm">${t.artist}</div>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="playSoundCloudSong('${t.title}', '${t.artist}', '${t.url}')" 
                            class="bg-orange-500 text-white px-3 py-1 rounded text-sm hover:bg-orange-600 transition-colors">
                        ‚ñ∂Ô∏è Play
                    </button>
                    <button onclick="removeSong(this)" class="text-white/60 hover:text-red-400 text-sm px-2">‚ùå</button>
                </div>
            </div>
        `).join(""))}createFromTemplate(t){var e={romantic:[{title:"Perfect",artist:"Ed Sheeran",mood:"romantic"},{title:"All of Me",artist:"John Legend",mood:"romantic"},{title:"Thinking Out Loud",artist:"Ed Sheeran",mood:"romantic"}],dinner:[{title:"Fly Me to the Moon",artist:"Frank Sinatra",mood:"jazz"},{title:"The Way You Look Tonight",artist:"Tony Bennett",mood:"jazz"},{title:"Unforgettable",artist:"Nat King Cole",mood:"jazz"}],roadtrip:[{title:"Life is a Highway",artist:"Tom Cochrane",mood:"energetic"},{title:"Born to Be Wild",artist:"Steppenwolf",mood:"energetic"},{title:"Take It Easy",artist:"Eagles",mood:"chill"}]}[t];e?(e={id:Date.now().toString(),name:t.charAt(0).toUpperCase()+t.slice(1)+" Playlist",songs:e,created:(new Date).toISOString(),type:t},this.userPlaylists.push(e),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification(`Created ${e.name}!`,"success"),this.updatePlaylistsGrid()):this.showNotification("Template not found","error")}generateActivityPlaylist(t){var e={gracies:{name:"Dinner at Gracie's",songs:[{title:"Autumn Leaves",artist:"Miles Davis",mood:"jazz"},{title:"Summertime",artist:"Ella Fitzgerald",mood:"jazz"},{title:"Blue Moon",artist:"Billie Holiday",mood:"jazz"}]},waterfront:{name:"Waterfront Cruise",songs:[{title:"Sailing",artist:"Christopher Cross",mood:"chill"},{title:"Come Monday",artist:"Jimmy Buffett",mood:"chill"},{title:"Banana Pancakes",artist:"Jack Johnson",mood:"chill"}]},museum:{name:"Museum Visit",songs:[{title:"Clair de Lune",artist:"Claude Debussy",mood:"classical"},{title:"Canon in D",artist:"Pachelbel",mood:"classical"},{title:"Ave Maria",artist:"Franz Schubert",mood:"classical"}]},arrival:{name:"Arrival Journey",songs:[{title:"Good as Hell",artist:"Lizzo",mood:"energetic"},{title:"Uptown Funk",artist:"Bruno Mars",mood:"energetic"},{title:"Can't Stop the Feeling!",artist:"Justin Timberlake",mood:"energetic"}]}}[t];e?(t={id:Date.now().toString(),name:e.name,songs:e.songs,created:(new Date).toISOString(),type:"activity",activity:t},this.userPlaylists.push(t),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification(`Generated ${e.name} playlist!`,"success"),this.updatePlaylistsGrid()):this.showNotification("Activity playlist not found","error")}generateMoodPlaylist(t){var e={romantic:[{title:"Perfect",artist:"Ed Sheeran"},{title:"All of Me",artist:"John Legend"},{title:"Thinking Out Loud",artist:"Ed Sheeran"},{title:"Make You Feel My Love",artist:"Adele"}],adventurous:[{title:"Adventure of a Lifetime",artist:"Coldplay"},{title:"Thunder",artist:"Imagine Dragons"},{title:"High Hopes",artist:"Panic! At The Disco"},{title:"Shut Up and Dance",artist:"Walk the Moon"}],chill:[{title:"Banana Pancakes",artist:"Jack Johnson"},{title:"Better Days",artist:"OneRepublic"},{title:"Riptide",artist:"Vance Joy"},{title:"Ho Hey",artist:"The Lumineers"}],energetic:[{title:"Uptown Funk",artist:"Bruno Mars"},{title:"Can't Stop the Feeling!",artist:"Justin Timberlake"},{title:"Good as Hell",artist:"Lizzo"},{title:"Levitating",artist:"Dua Lipa"}]}[t];e?(e={id:Date.now().toString(),name:t.charAt(0).toUpperCase()+t.slice(1)+" Vibes",songs:e,created:(new Date).toISOString(),type:"mood",mood:t},this.userPlaylists.push(e),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification(`Generated ${e.name} playlist!`,"success"),this.updatePlaylistsGrid()):this.showNotification("Mood playlist not found","error")}exploreLocalArtists(){var t=this.createModal("Local Providence Artists",`
            <div class="space-y-4">
                ${[{name:"The Low Anthem",genre:"Folk",from:"Providence, RI"},{name:"Deer Tick",genre:"Alt-Country",from:"Providence, RI"},{name:"Brown Bird",genre:"American Folk",from:"Providence, RI"},{name:"Roz Raskin",genre:"Folk",from:"Providence, RI"}].map(t=>`
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-lg">${t.name}</h4>
                        <p class="text-gray-600">${t.genre} ‚Ä¢ ${t.from}</p>
                    </div>
                `).join("")}
                <p class="text-sm text-gray-500 mt-4">
                    These artists represent the vibrant local music scene in Providence!
                </p>
            </div>
        `);document.body.appendChild(t),this.showNotification("Discovering local Providence artists!","info")}generateVenuePlaylist(){var t={id:Date.now().toString(),name:"Providence Venue Mix",songs:[{title:"Venue Song 1",artist:"Local Band",venue:"The Met"},{title:"Venue Song 2",artist:"Local Band",venue:"Lupo's"},{title:"Venue Song 3",artist:"Local Band",venue:"The Columbus Theatre"}],created:(new Date).toISOString(),type:"venue"};this.userPlaylists.push(t),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification("Generated Providence venue playlist!","success"),this.updatePlaylistsGrid()}getLocalRadioHits(){var t={id:Date.now().toString(),name:"Providence Radio Hits",songs:[{title:"Current Hit 1",artist:"Popular Artist",station:"WBRU"},{title:"Current Hit 2",artist:"Popular Artist",station:"94HJY"},{title:"Current Hit 3",artist:"Popular Artist",station:"KISS 95.1"}],created:(new Date).toISOString(),type:"radio"};this.userPlaylists.push(t),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification("Added current radio hits to your collection!","success"),this.updatePlaylistsGrid()}shareToSocial(t){var e,i=this.userPlaylists[0];i?(i=`Check out my "${i.name}" playlist from our Providence Anniversary! üéµüíï`,e=window.location.href,i={twitter:`https://twitter.com/intent/tweet?text=${encodeURIComponent(i)}&url=`+encodeURIComponent(e),facebook:"https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(e),instagram:"https://www.instagram.com/"},"instagram"===t?this.showNotification("Screenshot this playlist to share on Instagram!","info"):(e=i[t])&&(window.open(e,"_blank"),this.showNotification(`Sharing to ${t}!`,"success"))):this.showNotification("No playlist to share","error")}exportPlaylist(t){var e;this.userPlaylists[0]?(e={spotify:"https://open.spotify.com/",youtube:"https://music.youtube.com/",apple:"https://music.apple.com/"}[t])&&(window.open(e,"_blank"),this.showNotification(`Opening ${t} to create your playlist!`,"info")):this.showNotification("No playlist to export","error")}simulateCollaboration(){let i=document.getElementById("collaboration-feed");i&&(i.innerHTML="",['Partner added "Perfect" by Ed Sheeran','You added "All of Me" by John Legend','Partner removed "Song Title"','You created new playlist "Dinner Music"',"Partner liked your playlist",'You commented on "Romantic Vibes"'].forEach((e,t)=>{setTimeout(()=>{var t=document.createElement("div");t.className="text-sm text-white/80 py-2 border-b border-white/10",t.innerHTML=`
                    <div class="flex items-center gap-2">
                        <span class="text-xs text-white/60">${(new Date).toLocaleTimeString()}</span>
                        <span>${e}</span>
                    </div>
                `,i.appendChild(t),i.scrollTop=i.scrollHeight},1e3*t)}),this.showNotification("Collaboration demo started!","success"))}openCreatePlaylistModal(){let o=this.createModal("Create New Playlist",`
            <form id="create-playlist-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Playlist Name</label>
                    <input type="text" id="playlist-name" class="w-full p-2 border rounded-lg" placeholder="My Awesome Playlist" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                    <textarea id="playlist-description" class="w-full p-2 border rounded-lg h-24" placeholder="Describe your playlist..."></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Mood</label>
                    <select id="playlist-mood" class="w-full p-2 border rounded-lg">
                        <option value="romantic">Romantic</option>
                        <option value="energetic">Energetic</option>
                        <option value="chill">Chill</option>
                        <option value="adventurous">Adventurous</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Create Playlist
                    </button>
                </div>
            </form>
        `);document.body.appendChild(o),document.getElementById("create-playlist-form").addEventListener("submit",t=>{t.preventDefault();var t=document.getElementById("playlist-name").value,e=document.getElementById("playlist-description").value,i=document.getElementById("playlist-mood").value,e={id:Date.now().toString(),name:t,description:e,mood:i,songs:[],created:(new Date).toISOString(),type:"custom"};this.userPlaylists.push(e),this.saveData("anniversary_playlists",this.userPlaylists),this.showNotification(`Created "${t}" playlist!`,"success"),this.updatePlaylistsGrid(),o.remove()})}sharePlaylist(e){var t,i=this.userPlaylists.find(t=>t.id===e);i?(t=window.location.href+"#playlist="+e,navigator.share?navigator.share({title:i.name,text:`Check out my "${i.name}" playlist!`,url:t}):navigator.clipboard.writeText(t).then(()=>{this.showNotification("Playlist link copied to clipboard!","success")})):this.showNotification("Playlist not found","error")}updatePlaylistsGrid(){let i=document.getElementById("playlists-grid");i&&(i.querySelectorAll(".playlist-card"),this.userPlaylists.forEach(t=>{var e=document.createElement("div");e.className="playlist-card bg-white/10 backdrop-blur-sm rounded-xl overflow-hidden border border-white/20 hover:border-purple-400/50 transition-all duration-300",e.innerHTML=`
                <div class="playlist-cover bg-gradient-to-br from-purple-500 to-pink-500 h-48 flex items-center justify-center">
                    <div class="text-6xl">${this.getPlaylistEmoji(t.type)}</div>
                </div>
                <div class="p-4">
                    <h4 class="text-lg font-bold text-white mb-1">${t.name}</h4>
                    <p class="text-white/70 text-sm mb-2">${t.description||"Custom playlist"}</p>
                    <div class="flex justify-between items-center text-xs text-white/60 mb-4">
                        <span>${t.songs.length} songs ‚Ä¢ ${Math.round(3.5*t.songs.length)} min</span>
                        <span>üéµ ${t.type}</span>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="playPlaylist('${t.id}')" class="flex-1 bg-purple-500 text-white py-2 rounded-lg text-sm hover:bg-purple-600 transition-colors">
                            ‚ñ∂Ô∏è Play
                        </button>
                        <button onclick="sharePlaylist('${t.id}')" class="bg-white/10 text-white px-3 py-2 rounded-lg text-sm hover:bg-white/20 transition-colors">
                            üîó
                        </button>
                    </div>
                </div>
            `,i.appendChild(e)}))}getPlaylistEmoji(t){return{romantic:"üíï",energetic:"‚ö°",chill:"üåø",adventurous:"üöÄ",activity:"üéØ",mood:"üí≠",venue:"üé™",radio:"üìª",custom:"üéµ"}[t]||"üéµ"}scrollToSection(t){t=document.getElementById(t);t&&t.scrollIntoView({behavior:"smooth",block:"start"})}showLoveNote(){var t=["üíï Every moment with you is a beautiful adventure!","üåπ You make Providence even more magical!","üí´ Looking forward to our romantic getaway!","‚ù§Ô∏è You're my favorite person to explore with!","ü•∞ Can't wait to make more memories together!","üíñ Providence + You = Perfect Weekend!"],t=t[Math.floor(Math.random()*t.length)];let e=this.createModal("Love Note",`
            <div class="text-center">
                <div class="text-4xl mb-4">üíï</div>
                <p class="text-lg mb-4">${t}</p>
                <button onclick="this.closest('.fixed').remove()" class="bg-pink-500 text-white px-6 py-2 rounded-lg hover:bg-pink-600 transition-colors">
                    Aww, thank you! üí´
                </button>
            </div>
        `);document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},5e3)}generateBudgetPlan(){var t=this.budgetData.meals+this.budgetData.drinks+this.budgetData.extras,t=this.createModal("Budget Plan",`
            <div class="space-y-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Estimated Costs</h4>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span>Meals:</span>
                            <span class="font-semibold">$${this.budgetData.meals}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Drinks:</span>
                            <span class="font-semibold">$${this.budgetData.drinks}</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Extras:</span>
                            <span class="font-semibold">$${this.budgetData.extras}</span>
                        </div>
                        <div class="border-t pt-2 flex justify-between font-bold">
                            <span>Total (with tax/tip):</span>
                            <span class="text-green-600">$${Math.round(1.25*t)}</span>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <button onclick="this.closest('.fixed').remove()" class="bg-blue-500 text-white px-6 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Got it!
                    </button>
                </div>
            </div>
        `);document.body.appendChild(t)}openModal(t,e){var i=document.createElement("div");i.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",i.innerHTML=`
            <div class="relative max-w-4xl max-h-full p-4">
                <img src="${t}" alt="${e}" class="max-w-full max-h-full object-contain rounded-lg">
                <button onclick="this.closest('.fixed').remove()" class="absolute top-2 right-2 text-white text-2xl bg-black bg-opacity-50 rounded-full w-8 h-8 flex items-center justify-center hover:bg-opacity-75 transition-opacity">
                    √ó
                </button>
                <div class="text-white text-center mt-2 bg-black bg-opacity-50 rounded px-3 py-1">
                    ${e}
                </div>
            </div>
        `,document.body.appendChild(i)}closeModal(){document.querySelectorAll(".fixed").forEach(t=>{t.querySelector("img")&&t.remove()})}createModal(t,e){var i=document.createElement("div");return i.className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",i.innerHTML=`
            <div class="bg-white rounded-xl p-6 max-w-md mx-4 max-h-96 overflow-y-auto">
                <h3 class="text-xl font-bold mb-4">${t}</h3>
                ${e}
            </div>
        `,i}setupEventListeners(){document.addEventListener("keydown",t=>{"Escape"===t.key&&document.querySelectorAll(".fixed").forEach(t=>t.remove())}),document.addEventListener("click",t=>{t.target.classList.contains("fixed")&&t.target.remove()})}setupPhotoGallery(){document.querySelectorAll(".photo-gallery img").forEach(t=>{t.addEventListener("click",()=>{this.openModal(t.src,t.alt)})})}setupInteractiveMap(){document.getElementById("map")&&"undefined"!=typeof L&&(this.map=L.map("map").setView([this.providenceCoords.lat,this.providenceCoords.lng],13),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(this.map),this.addLocationMarkers())}addLocationMarkers(){[{name:"Gracie's Restaurant",lat:41.8236,lng:-71.4118,type:"restaurant"},{name:"Federal Hill",lat:41.8186,lng:-71.4188,type:"area"},{name:"Waterfront",lat:41.8173,lng:-71.4012,type:"scenic"},{name:"Downtown",lat:41.8236,lng:-71.4128,type:"area"}].forEach(t=>{L.marker([t.lat,t.lng]).addTo(this.map).bindPopup(`<b>${t.name}</b><br>Type: `+t.type)})}setupOfflineMode(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").then(t=>{console.log("SW registered: ",t)}).catch(t=>{console.log("SW registration failed: ",t)})}setupPWAInstallPrompt(){let e;window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),e=t,setTimeout(()=>{e&&this.showInstallPrompt(e)},5e3)})}showInstallPrompt(t){let e=document.createElement("div");e.className="fixed bottom-4 left-4 right-4 bg-blue-500 text-white p-4 rounded-xl shadow-lg z-50 flex items-center justify-between",e.innerHTML=`
            <span>Install this app for the best experience!</span>
            <div class="flex gap-2">
                <button id="install-app" class="bg-white text-blue-500 px-3 py-1 rounded-lg text-sm font-semibold">Install</button>
                <button id="dismiss-install" class="text-white/80 hover:text-white px-2">‚úï</button>
            </div>
        `,document.body.appendChild(e),document.getElementById("install-app").addEventListener("click",async()=>{t.prompt();var{}=await t.userChoice;t=null,e.remove()}),document.getElementById("dismiss-install").addEventListener("click",()=>{e.remove()})}restoreUserData(){var t=localStorage.getItem("anniversary_current_tab");t&&(t=document.querySelector(`[data-tab="${t}"]`))&&t.click()}toggleEditMode(){this.isEditMode=!this.isEditMode,this.showNotification(this.isEditMode?"Edit mode enabled":"Edit mode disabled","info")}addItineraryItem(){this.showNotification("Add itinerary item functionality - open modal here","info")}saveItinerary(){this.saveData("anniversary_itinerary",this.itineraryData),this.showNotification("Itinerary saved successfully!","success")}resetItinerary(){this.itineraryData=this.getDefaultItinerary(),this.saveData("anniversary_itinerary",this.itineraryData),this.showNotification("Itinerary reset to default","info")}getDefaultItinerary(){return{day1:[{time:"2:00 PM",activity:"Arrive in Providence",icon:"‚úàÔ∏è"},{time:"3:00 PM",activity:"Check into hotel",icon:"üè®"},{time:"6:00 PM",activity:"Dinner at Gracie's",icon:"üçΩÔ∏è"}],day2:[{time:"9:00 AM",activity:"Breakfast at hotel",icon:"‚òï"},{time:"10:30 AM",activity:"Explore Federal Hill",icon:"üèõÔ∏è"},{time:"1:00 PM",activity:"Lunch at Italian restaurant",icon:"üçù"}]}}showPhotoUploadModal(){let e=this.createModal("Upload Photo",`
            <form id="photo-upload-form" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Photo</label>
                    <input type="file" id="photo-input" accept="image/*" class="w-full p-2 border rounded-lg" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Caption</label>
                    <input type="text" id="photo-caption" class="w-full p-2 border rounded-lg" placeholder="A beautiful moment...">
                </div>
                <div class="flex gap-2">
                    <button type="button" onclick="this.closest('.fixed').remove()" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="flex-1 bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600 transition-colors">
                        Upload
                    </button>
                </div>
            </form>
        `);document.body.appendChild(e),document.getElementById("photo-upload-form").addEventListener("submit",t=>{t.preventDefault(),this.handlePhotoUpload(),e.remove()})}handlePhotoUpload(){var t,e=document.getElementById("photo-input");let i=document.getElementById("photo-caption").value;0<e.files.length&&(e=e.files[0],(t=new FileReader).onload=t=>{var t={src:t.target.result,caption:i,timestamp:(new Date).toISOString()},e=this.loadData("anniversary_photos",[]);e.push(t),this.saveData("anniversary_photos",e),this.showNotification("Photo uploaded successfully!","success")},t.readAsDataURL(e))}async syncWithPiServer(){try{if(this.showNotification("Syncing with Pi server...","info"),!(await fetch("http://192.168.68.69:8080/api/sync",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({itinerary:this.itineraryData,notes:this.notesData,photos:this.loadData("anniversary_photos",[]),playlists:this.userPlaylists})})).ok)throw new Error("Sync failed");this.showNotification("Synced successfully with Pi server!","success")}catch(t){console.error("Sync error:",t),this.showNotification("Pi server sync failed (server may be offline)","error")}}focusMapLocation(t){var e;this.map&&(e={gracies:[41.8236,-71.4118],"federal-hill":[41.8186,-71.4188],waterfront:[41.8173,-71.4012],downtown:[41.8236,-71.4128]}[t])&&(this.map.setView(e,16),this.showNotification("Focused on "+t,"info"))}startAddingCustomPoint(){this.map&&(this.showNotification("Click on the map to add a custom point","info"),this.map.on("click",t=>{var{lat:t,lng:e}=t.latlng,i=prompt("Enter a name for this location:");i&&this.addCustomPoint(t,e,i)}))}addCustomPoint(t,e,i){var o={lat:t,lng:e,name:i,id:Date.now().toString()};this.customMapPoints.push(o),this.saveData("anniversary_custom_points",this.customMapPoints),L.marker([t,e]).addTo(this.map).bindPopup(`<b>${i}</b><br>Custom point`),this.showNotification("Added custom point: "+i,"success")}viewCustomPoints(){var t;0===this.customMapPoints.length?this.showNotification("No custom points added yet","info"):(t=this.customMapPoints.map(t=>`
            <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                <span>${t.name}</span>
                <button onclick="removeCustomPoint('${t.id}')" class="text-red-500 text-sm">Remove</button>
            </div>
        `).join(""),t=this.createModal("Custom Points",`
            <div class="space-y-2">
                ${t}
            </div>
        `),document.body.appendChild(t))}clearCustomPoints(){this.customMapPoints=[],this.saveData("anniversary_custom_points",[]),this.showNotification("All custom points cleared","info")}showMusicServicesModal(){var t=this.createModal("Music Services",`
            <div class="space-y-4">
                <p class="text-gray-600">Connect your music services to sync playlists:</p>
                <div class="space-y-2">
                    <button class="w-full bg-green-500 text-white py-2 rounded-lg hover:bg-green-600 transition-colors">
                        üéµ Connect Spotify
                    </button>
                    <button class="w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition-colors">
                        üì∫ Connect YouTube Music
                    </button>
                    <button class="w-full bg-gray-700 text-white py-2 rounded-lg hover:bg-gray-800 transition-colors">
                        üçé Connect Apple Music
                    </button>
                </div>
                <p class="text-sm text-gray-500">Music integration coming soon!</p>
            </div>
        `);document.body.appendChild(t)}toggleMusic(t){this.isPlaying?this.stopAll():(this.showNotification("Playing track "+t,"info"),this.isPlaying=!0,this.updatePlayButtons())}}document.addEventListener("DOMContentLoaded",()=>{window.providenceApp=new ProvidenceAnniversaryApp}),window.closeModal=()=>{document.querySelectorAll(".fixed").forEach(t=>{(t.querySelector("img")||t.querySelector("h3"))&&t.remove()})},document.addEventListener("click",t=>{t.target.classList.contains("fixed")&&t.target.style.backgroundColor.includes("black")&&t.target.remove()}),document.addEventListener("keydown",t=>{"Escape"===t.key&&document.querySelectorAll(".fixed").forEach(t=>t.remove())});